<!doctype html>
<head>
  <meta charset="utf-8">

  <title>Chat App</title>
  <meta name="description" content="My Parse App">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/styles.css">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
    <script type="text/javascript" src="js/script.js"></script>
</head>

<body>
  
  <div id="main">
      
    
   <h1>Chat App</h1>
      <h1>Log Out</h1>
      
      <form id="logout">
          <p><input id="logout-submit" type="submit" value="Log Out"></p>
      </form>
      
      <form id="post-form">
          <p><textarea id="post-content" rows="3" cols="50"></textarea></p>
          <p><button id="post-submit">submit</button></p>
          
      </form>
      
      <textarea id="post-list" rows="15" cols="50" id="aboutDescription"
    style="max-height:100px;min-height:200px; resize: none"></textarea>
      
  </div>
    
    <script type="text/javascript">
     Parse.initialize("6GDVKxEbjD12uv4BCBwBG14O4A0lha677JrSFOt7", "kaSnkEa2P1Gh9C8Bq4escEHHR8dTxqnsY2glzbcH");

      var Post=Parse.Object.extend("message");
        
        
   function checkLogin(){
        if (Parse.User.current()){
            //console.log("Logged In"+Parse.User.current().get("sender"));
            $("#current-user").html("user: "+Parse.User.current().get("sender"));
        }
          else{
            $("#current-user").html("");
          }
      }
       
       
      
     /* User LogOut*/
       $("#logout").submit(function(event){
            event.preventDefault();
          window.location.href="login.html"; 
          Parse.User.logOut();
           checkLogin();
      });
        
       /*For posting the data*/
        $("#post-form").submit(function(event){
            event.preventDefault();
            
            var content= $("#post-content").val();
            
            var newPost=new Post();
            newPost.set("message",content);
            
            newPost.save(
                {success:function(){
                
                },
                 error:function(error){
                  console.log("error:"+error.message)    
                 }
                });
        });
        
        
        /*For retrieving the message*/
        
        function getPosts(){
            var query= new Parse.Query(Post);
            query.find({success:function(results){
                var output="";
                    for(var i in results){
                    var chat=results[i].get("message");
//                        output+="<br>";
                        output+='\n' + chat;                    
                    } 
                  $("#post-list").html(output);
                
                },error:function(error){
                  console.log("error:"+error.message)    
                 }
                });
           
        }
       $("#post-form").submit(function(){
             getPosts();
           
       });
       
      
        
  
    </script>

  
</body>

</html>
